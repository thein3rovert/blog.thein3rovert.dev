services:
  astro-app:
    build:
      context: .
      dockerfile: Dockerfile
    image: ${IMAGE_NAME}:latest
    container_name: ${CONTAINER_NAME}
    ports:
      - "8080:3001"  # Container listens on 80, exposed as 8080
    restart: unless-stopped
    networks:
      - local
      - traefik_proxy
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.astro-app.rule=Host(`blog.thein3rovert.dev`)"
      - "traefik.http.routers.astro-app.entrypoints=web"
      - "traefik.http.services.astro-app.loadbalancer.server.port=3001"

networks:
  traefik_proxy:
    external: true
  local:
    driver: bridge

