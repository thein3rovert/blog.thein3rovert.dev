---
import { menuLinks } from "@/site.config";
import { getWordCount, formatStatDate } from "@/utils/terminal";

import type { CollectionEntry } from "astro:content";

interface Props {
	content?: CollectionEntry<"post"> | undefined; // Make content optional
}

const url = new URL(Astro.request.url);
const currentPath = url.pathname;

const { content } = Astro.props;

// Only destructure data and body if content exists
const data = content?.data;
const body = content?.body;

// Dynamic content for blog posts vs static content for other pages
let filePath: string;
let fileSize: string;
let modifyDate: string;
let birthDate: string;

if (content && data) {
	// Blog post - show dynamic information
	const wordCount = body ? getWordCount(body) : 0;
	const category = data.tags?.[0] || "blog";
	const publishDate = new Date(data.publishDate);
	const updatedDate = data.updatedDate ? new Date(data.updatedDate) : publishDate;

	filePath = `/home/thein3rovert/posts/${category}/${data.title}`;
	fileSize = `${wordCount} words`;
	modifyDate = formatStatDate(updatedDate);
	birthDate = formatStatDate(publishDate);
} else {
	// Static content for non-blog pages
	const currentDate = new Date();
	const staticBirthDate = formatStatDate(new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)); // 30 days ago

	// Determine current file path based on route
	if (currentPath === "/") {
		filePath = "/home/thein3rovert";
		fileSize = "16488 words";
	} else if (currentPath.startsWith("/posts/") || currentPath.startsWith("/blog/")) {
		filePath = "~/posts";
		fileSize = "12000 words";
	} else if (currentPath.startsWith("/about")) {
		filePath = "~/about";
		fileSize = "800 words";
	} else if (currentPath.startsWith("/notes")) {
		filePath = "~/notes";
		fileSize = "500 words";
	} else if (currentPath.startsWith("/code")) {
		filePath = "~/code";
		fileSize = "2000 words";
	} else {
		filePath = "/home/thein3rovert/posts";
		fileSize = "16488 words";
	}

	modifyDate = formatStatDate(currentDate);
	birthDate = staticBirthDate;
}
---

<header class="bg-global-bg mb-8 w-full font-mono text-[13px]" id="main-header">
	<div class="mx-auto max-w-6xl px-4 py-2 sm:px-8">
		<!-- Terminal file header -->
		<div class="mb-2 space-y-0 leading-tight">
			<div class="hover:text-accent cursor-pointer">
				<a href="/" class="font-bold hover:underline">
					File: {filePath}
				</a>
			</div>
			<div>Size: {fileSize}</div>
			<div class="hidden sm:block">
				Access: (0644/-rw-r--r--) Uid: ( 1000/thein3rovert) Gid: ( 100 / users)
			</div>
			<div>Modify: {modifyDate}</div>
			<div>Birth: {birthDate}</div>
		</div>

		<!-- Navigation -->
		<div class="flex flex-wrap items-center">
			{
				menuLinks.map((link, index) => (
					<span>
						<a
							href={link.path}
							class={`no-highlight hover:underline ${
								currentPath === link.path ||
								(link.path !== "/" && currentPath.startsWith(link.path))
									? "text-accent font-bold"
									: "text-accent"
							}`}
							data-astro-prefetch
						>
							{link.title}
						</a>
						{index < menuLinks.length - 1 && <span class="ml-1 text-gray-400">|</span>}
					</span>
				))
			}
			<div class="ml-auto">
				<div class="scale-75 text-xs">
					<!-- <ThemeToggle /> -->
				</div>
			</div>
		</div>
	</div>
</header>

<style>
	.font-mono {
		font-family: "IoskeleyMono";
		letter-spacing: 0;
	}

	a {
		color: inherit;
		text-decoration: none;
	}

	a:hover:not(.no-highlight) {
		text-decoration: underline;
	}

	.no-highlight:hover {
		background-color: transparent !important;
		color: inherit !important;
		padding: 0 !important;
		border-radius: 0 !important;
		font-weight: inherit !important;
		text-decoration: underline !important;
	}

	/* Terminal header styling - full width at top */
	header {
		backdrop-filter: blur(8px);
		border-bottom: 1px solid #4a5568;
		opacity: 0.7;
	}

	/* Dark mode adjustments */
	:global(.dark) header {
		border-bottom-color: #718096;
		background: rgba(0, 0, 0, 0.8);
	}

	:global(.light) header {
		background: rgba(255, 255, 255, 0.9);
	}
</style>
